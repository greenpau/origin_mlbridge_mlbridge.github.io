<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>middleware API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>middleware</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import json

from flask import Flask, jsonify, request
import numpy as np
from elasticsearch import Elasticsearch
from datetime import datetime
from tensorflow.keras import models


app = Flask(__name__)


def string_to_ascii(string):
    &#34;&#34;&#34;

    Function that converts the domain name to an integer array of ASCII values.

    Args:
        string: Contains the Domain Name entered by the user.

    Returns:
        A numpy array of ASCII values corresponding to the characters of the
        Domain Name

    &#34;&#34;&#34;
    ascii_arr = np.zeros(len(string))
    for i in range(len(string)):
        ascii_arr[i] = ord(string[i])
    return ascii_arr


def mal_and_benign_list_creation(es):
    &#34;&#34;&#34;

    Function that creates an empty list for malicious and benign domains.

    Args:
        es: Contains the Elasticsearch object.

    Returns:
        Not applicable.

    &#34;&#34;&#34;
    if (&#39;mal&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;benign&#39; not in es.indices.get(&#39;*&#39;)):
        es.index(index=&#39;mal&#39;, id=1, body={})
        es.index(index=&#39;benign&#39;, id=1, body={})


def vetted_list_creation(es):
    &#34;&#34;&#34;

    Function that creates an empty list for not vetted, benign, honeypot and
    malicious domains.

    Args:
        es: Contains the Elasticsearch object.

    Returns:
        Not applicable.

    &#34;&#34;&#34;
    if (&#39;not_vetted&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;benign_vet&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;honeypot&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;blacklist&#39; not in es.indices.get(&#39;*&#39;)):
        es.index(index=&#39;not_vetted&#39;, id=1, body={})
        es.index(index=&#39;benign_vet&#39;, id=1, body={})
        es.index(index=&#39;honeypot&#39;, id=1, body={})
        es.index(index=&#39;blacklist&#39;, id=1, body={})


def list_updation(es, domain_name, send):
    &#34;&#34;&#34;

    Function that updates the updates the malicious and benign lists depending
    on how many people have queried that particular domain and also the model
    confidence score regarding whether the domain is malicious or not.

    Args:
        es: Contains the Elasticsearch object.
        domain_name: Contains the domain name corresponding to which the list
                     will be updated.
        send: Contains the model prediction score whether the domain is
              malicious or benign.

    Returns:
        Not Applicable

    &#34;&#34;&#34;

    body_not_vetted = es.get(index=&#39;not_vetted&#39;, id=1)[&#39;_source&#39;]

    if float(send) &lt; 0.5:
        body = es.get(index=&#39;benign&#39;, id=1)[&#39;_source&#39;]
        if domain_name in body.keys():
            body[domain_name][&#39;count&#39;] += 1
        else:
            body[domain_name] = {}
            body[domain_name][&#39;count&#39;] = 1
            body[domain_name][&#39;status&#39;] = \
                float(format(((1 - float(send)) * 100), &#39;.2f&#39;))

            if body[domain_name][&#39;status&#39;] &lt; 90:
                body_not_vetted[domain_name] = {}
                body_not_vetted[domain_name][&#39;class&#39;] = &#39;Benign&#39;
                body_not_vetted[domain_name][&#39;acc&#39;] = \
                    float(format(((1 - float(send)) * 100), &#39;.2f&#39;))

                update_body_not_vetted = \
                    {&#39;doc&#39;: {domain_name: body_not_vetted[domain_name]}}
                es.update(index=&#39;not_vetted&#39;, id=1,
                          body=update_body_not_vetted)

        update_body = {&#39;doc&#39;: {domain_name: body[domain_name]}}
        es.update(index=&#39;benign&#39;, id=1, body=update_body)

    else:
        body = es.get(index=&#39;mal&#39;, id=1)[&#39;_source&#39;]
        if domain_name in body.keys():
            body[domain_name][&#39;count&#39;] += 1
        else:
            body[domain_name] = {}
            body[domain_name][&#39;count&#39;] = 1
            body[domain_name][&#39;status&#39;] = \
                float(format(float(send) * 100, &#39;.2f&#39;))

            if body[domain_name][&#39;status&#39;] &lt; 90:
                body_not_vetted[domain_name] = {}
                body_not_vetted[domain_name][&#39;class&#39;] = &#39;Malicious&#39;
                body_not_vetted[domain_name][&#39;acc&#39;] = \
                    float(format(float(send) * 100, &#39;.2f&#39;))

                update_body_not_vetted = \
                    {&#39;doc&#39;: {domain_name: body_not_vetted[domain_name]}}
                es.update(index=&#39;not_vetted&#39;, id=1,
                          body=update_body_not_vetted)

        update_body = {&#39;doc&#39;: {domain_name: body[domain_name]}}
        es.update(index=&#39;mal&#39;, id=1, body=update_body)


def update_historical_analysis(es, domain_name, ip, send, date_time):
    &#34;&#34;&#34;

    Function that updates the date and time at which a particular domain is
    queried along with the IP address of the machine that queries that
    particular domain. Moreover, the model confidence score regarding whether
    the domain is malicious or not is also updated.

    Args:
        es: Contains the Elasticsearch object.
        domain_name: Contains the domain name corresponding to which the list
                     will be updated.
        ip: Contains the IP address of the machine querying that domain.
        send: Contains the model prediction score whether the domain is
              malicious or benign.
        date_time: Contains the date as well as the time the request is
                   processed.

    Returns:
        Not applicable.

    &#34;&#34;&#34;

    date = str(date_time.date())
    year = str(date_time.date().year)
    month = str(date_time.date().month)
    day = str(date_time.date().day)
    hour = str(date_time.time().hour)
    minutes = str(date_time.time().minute)

    if domain_name in es.indices.get(&#39;*&#39;):
        body = es.get(index=domain_name, id=1)[&#39;_source&#39;]
        if date in body.keys():
            if hour in body[date].keys():
                if minutes in body[date][hour].keys():
                    body[date][hour][minutes] += 1
                else:
                    body[date][hour][minutes] = 1
            else:
                body[date][hour] = {minutes: 1}
        else:
            body[date] = {hour: {minutes: 1}}

        if year in body.keys():
            if month in body[year].keys():
                if day in body[year][month].keys():
                    body[year][month][day] += 1
                else:
                    body[year][month][day] = 1
            else:
                body[year][month] = {day: 1}
        else:
            body[year] = {month: {day: 1}}

        if ip in body[&#39;count&#39;].keys():
            body[&#39;count&#39;][ip] += 1
        else:
            body[&#39;count&#39;][ip] = 1

        update_body = {
            &#39;doc&#39;: {date: {hour: {minutes: body[date][hour][minutes]}},
                    year: {month: {day: body[year][month][day]}},
                    &#39;count&#39;: body[&#39;count&#39;]}}
        es.update(index=domain_name, id=1, body=update_body)

    else:
        body = {date: {hour: {minutes: 1}}, year: {month: {day: 1}},
                &#39;count&#39;: {ip: 1}, &#39;status&#39;: send}
        es.index(index=domain_name, id=1, body=body)


@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def server():
    &#34;&#34;&#34;

    Function that processes the request and then sends back a JSON message via
    the hyper text transfer protocol to the ML Bridge Plugin that contains the
    confidence score regarding whether the domain is malicious or benign.

    Returns:
        A JSON message that contains the confidence score regarding whether the
        request is of a malicious or a benign domain.

    &#34;&#34;&#34;


    es = Elasticsearch()

    model = models.load_model(
        &#39;../../../mlbridge-machine-learning/saved_models/dns_alert_model.hdf5&#39;)

    mal_and_benign_list_creation(es)
    vetted_list_creation(es)

    if request.method == &#39;POST&#39;:

        domain_json = request.get_json()
        key = list(domain_json.keys())
        domain_name = domain_json[key[0]]
        domain_name = domain_name.split(&#39;www.&#39;)

        if len(domain_name) == 1:
            domain_name = domain_name[0]
        else:
            domain_name = domain_name[1]

        ip = domain_json[key[1]]
        date_time = datetime.now()

        input_ = np.zeros(256)
        input_[0:len(domain_json[key[0]])] = string_to_ascii(domain_json[key[0]])
        input_ = np.reshape(input_, (1, 16, 16, 1))
        send = str(model.predict(input_)[0, 0])

        list_updation(es, domain_name, send)
        update_historical_analysis(es, domain_name, ip, send, date_time)

        return jsonify({&#39;p&#39;: send})


if __name__ == &#39;__main__&#39;:
    app.run(debug=True)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="middleware.list_updation"><code class="name flex">
<span>def <span class="ident">list_updation</span></span>(<span>es, domain_name, send)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that updates the updates the malicious and benign lists depending
on how many people have queried that particular domain and also the model
confidence score regarding whether the domain is malicious or not.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>es</code></strong></dt>
<dd>Contains the Elasticsearch object.</dd>
<dt><strong><code>domain_name</code></strong></dt>
<dd>Contains the domain name corresponding to which the list
will be updated.</dd>
<dt><strong><code>send</code></strong></dt>
<dd>Contains the model prediction score whether the domain is
malicious or benign.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Not Applicable</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_updation(es, domain_name, send):
    &#34;&#34;&#34;

    Function that updates the updates the malicious and benign lists depending
    on how many people have queried that particular domain and also the model
    confidence score regarding whether the domain is malicious or not.

    Args:
        es: Contains the Elasticsearch object.
        domain_name: Contains the domain name corresponding to which the list
                     will be updated.
        send: Contains the model prediction score whether the domain is
              malicious or benign.

    Returns:
        Not Applicable

    &#34;&#34;&#34;

    body_not_vetted = es.get(index=&#39;not_vetted&#39;, id=1)[&#39;_source&#39;]

    if float(send) &lt; 0.5:
        body = es.get(index=&#39;benign&#39;, id=1)[&#39;_source&#39;]
        if domain_name in body.keys():
            body[domain_name][&#39;count&#39;] += 1
        else:
            body[domain_name] = {}
            body[domain_name][&#39;count&#39;] = 1
            body[domain_name][&#39;status&#39;] = \
                float(format(((1 - float(send)) * 100), &#39;.2f&#39;))

            if body[domain_name][&#39;status&#39;] &lt; 90:
                body_not_vetted[domain_name] = {}
                body_not_vetted[domain_name][&#39;class&#39;] = &#39;Benign&#39;
                body_not_vetted[domain_name][&#39;acc&#39;] = \
                    float(format(((1 - float(send)) * 100), &#39;.2f&#39;))

                update_body_not_vetted = \
                    {&#39;doc&#39;: {domain_name: body_not_vetted[domain_name]}}
                es.update(index=&#39;not_vetted&#39;, id=1,
                          body=update_body_not_vetted)

        update_body = {&#39;doc&#39;: {domain_name: body[domain_name]}}
        es.update(index=&#39;benign&#39;, id=1, body=update_body)

    else:
        body = es.get(index=&#39;mal&#39;, id=1)[&#39;_source&#39;]
        if domain_name in body.keys():
            body[domain_name][&#39;count&#39;] += 1
        else:
            body[domain_name] = {}
            body[domain_name][&#39;count&#39;] = 1
            body[domain_name][&#39;status&#39;] = \
                float(format(float(send) * 100, &#39;.2f&#39;))

            if body[domain_name][&#39;status&#39;] &lt; 90:
                body_not_vetted[domain_name] = {}
                body_not_vetted[domain_name][&#39;class&#39;] = &#39;Malicious&#39;
                body_not_vetted[domain_name][&#39;acc&#39;] = \
                    float(format(float(send) * 100, &#39;.2f&#39;))

                update_body_not_vetted = \
                    {&#39;doc&#39;: {domain_name: body_not_vetted[domain_name]}}
                es.update(index=&#39;not_vetted&#39;, id=1,
                          body=update_body_not_vetted)

        update_body = {&#39;doc&#39;: {domain_name: body[domain_name]}}
        es.update(index=&#39;mal&#39;, id=1, body=update_body)</code></pre>
</details>
</dd>
<dt id="middleware.mal_and_benign_list_creation"><code class="name flex">
<span>def <span class="ident">mal_and_benign_list_creation</span></span>(<span>es)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that creates an empty list for malicious and benign domains.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>es</code></strong></dt>
<dd>Contains the Elasticsearch object.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Not applicable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mal_and_benign_list_creation(es):
    &#34;&#34;&#34;

    Function that creates an empty list for malicious and benign domains.

    Args:
        es: Contains the Elasticsearch object.

    Returns:
        Not applicable.

    &#34;&#34;&#34;
    if (&#39;mal&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;benign&#39; not in es.indices.get(&#39;*&#39;)):
        es.index(index=&#39;mal&#39;, id=1, body={})
        es.index(index=&#39;benign&#39;, id=1, body={})</code></pre>
</details>
</dd>
<dt id="middleware.server"><code class="name flex">
<span>def <span class="ident">server</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that processes the request and then sends back a JSON message via
the hyper text transfer protocol to the ML Bridge Plugin that contains the
confidence score regarding whether the domain is malicious or benign.</p>
<h2 id="returns">Returns</h2>
<p>A JSON message that contains the confidence score regarding whether the
request is of a malicious or a benign domain.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def server():
    &#34;&#34;&#34;

    Function that processes the request and then sends back a JSON message via
    the hyper text transfer protocol to the ML Bridge Plugin that contains the
    confidence score regarding whether the domain is malicious or benign.

    Returns:
        A JSON message that contains the confidence score regarding whether the
        request is of a malicious or a benign domain.

    &#34;&#34;&#34;


    es = Elasticsearch()

    model = models.load_model(
        &#39;../../../mlbridge-machine-learning/saved_models/dns_alert_model.hdf5&#39;)

    mal_and_benign_list_creation(es)
    vetted_list_creation(es)

    if request.method == &#39;POST&#39;:

        domain_json = request.get_json()
        key = list(domain_json.keys())
        domain_name = domain_json[key[0]]
        domain_name = domain_name.split(&#39;www.&#39;)

        if len(domain_name) == 1:
            domain_name = domain_name[0]
        else:
            domain_name = domain_name[1]

        ip = domain_json[key[1]]
        date_time = datetime.now()

        input_ = np.zeros(256)
        input_[0:len(domain_json[key[0]])] = string_to_ascii(domain_json[key[0]])
        input_ = np.reshape(input_, (1, 16, 16, 1))
        send = str(model.predict(input_)[0, 0])

        list_updation(es, domain_name, send)
        update_historical_analysis(es, domain_name, ip, send, date_time)

        return jsonify({&#39;p&#39;: send})</code></pre>
</details>
</dd>
<dt id="middleware.string_to_ascii"><code class="name flex">
<span>def <span class="ident">string_to_ascii</span></span>(<span>string)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that converts the domain name to an integer array of ASCII values.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>string</code></strong></dt>
<dd>Contains the Domain Name entered by the user.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>A numpy array of ASCII values corresponding to the characters of the
Domain Name</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def string_to_ascii(string):
    &#34;&#34;&#34;

    Function that converts the domain name to an integer array of ASCII values.

    Args:
        string: Contains the Domain Name entered by the user.

    Returns:
        A numpy array of ASCII values corresponding to the characters of the
        Domain Name

    &#34;&#34;&#34;
    ascii_arr = np.zeros(len(string))
    for i in range(len(string)):
        ascii_arr[i] = ord(string[i])
    return ascii_arr</code></pre>
</details>
</dd>
<dt id="middleware.update_historical_analysis"><code class="name flex">
<span>def <span class="ident">update_historical_analysis</span></span>(<span>es, domain_name, ip, send, date_time)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that updates the date and time at which a particular domain is
queried along with the IP address of the machine that queries that
particular domain. Moreover, the model confidence score regarding whether
the domain is malicious or not is also updated.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>es</code></strong></dt>
<dd>Contains the Elasticsearch object.</dd>
<dt><strong><code>domain_name</code></strong></dt>
<dd>Contains the domain name corresponding to which the list
will be updated.</dd>
<dt><strong><code>ip</code></strong></dt>
<dd>Contains the IP address of the machine querying that domain.</dd>
<dt><strong><code>send</code></strong></dt>
<dd>Contains the model prediction score whether the domain is
malicious or benign.</dd>
<dt><strong><code>date_time</code></strong></dt>
<dd>Contains the date as well as the time the request is
processed.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Not applicable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_historical_analysis(es, domain_name, ip, send, date_time):
    &#34;&#34;&#34;

    Function that updates the date and time at which a particular domain is
    queried along with the IP address of the machine that queries that
    particular domain. Moreover, the model confidence score regarding whether
    the domain is malicious or not is also updated.

    Args:
        es: Contains the Elasticsearch object.
        domain_name: Contains the domain name corresponding to which the list
                     will be updated.
        ip: Contains the IP address of the machine querying that domain.
        send: Contains the model prediction score whether the domain is
              malicious or benign.
        date_time: Contains the date as well as the time the request is
                   processed.

    Returns:
        Not applicable.

    &#34;&#34;&#34;

    date = str(date_time.date())
    year = str(date_time.date().year)
    month = str(date_time.date().month)
    day = str(date_time.date().day)
    hour = str(date_time.time().hour)
    minutes = str(date_time.time().minute)

    if domain_name in es.indices.get(&#39;*&#39;):
        body = es.get(index=domain_name, id=1)[&#39;_source&#39;]
        if date in body.keys():
            if hour in body[date].keys():
                if minutes in body[date][hour].keys():
                    body[date][hour][minutes] += 1
                else:
                    body[date][hour][minutes] = 1
            else:
                body[date][hour] = {minutes: 1}
        else:
            body[date] = {hour: {minutes: 1}}

        if year in body.keys():
            if month in body[year].keys():
                if day in body[year][month].keys():
                    body[year][month][day] += 1
                else:
                    body[year][month][day] = 1
            else:
                body[year][month] = {day: 1}
        else:
            body[year] = {month: {day: 1}}

        if ip in body[&#39;count&#39;].keys():
            body[&#39;count&#39;][ip] += 1
        else:
            body[&#39;count&#39;][ip] = 1

        update_body = {
            &#39;doc&#39;: {date: {hour: {minutes: body[date][hour][minutes]}},
                    year: {month: {day: body[year][month][day]}},
                    &#39;count&#39;: body[&#39;count&#39;]}}
        es.update(index=domain_name, id=1, body=update_body)

    else:
        body = {date: {hour: {minutes: 1}}, year: {month: {day: 1}},
                &#39;count&#39;: {ip: 1}, &#39;status&#39;: send}
        es.index(index=domain_name, id=1, body=body)</code></pre>
</details>
</dd>
<dt id="middleware.vetted_list_creation"><code class="name flex">
<span>def <span class="ident">vetted_list_creation</span></span>(<span>es)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that creates an empty list for not vetted, benign, honeypot and
malicious domains.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>es</code></strong></dt>
<dd>Contains the Elasticsearch object.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Not applicable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def vetted_list_creation(es):
    &#34;&#34;&#34;

    Function that creates an empty list for not vetted, benign, honeypot and
    malicious domains.

    Args:
        es: Contains the Elasticsearch object.

    Returns:
        Not applicable.

    &#34;&#34;&#34;
    if (&#39;not_vetted&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;benign_vet&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;honeypot&#39; not in es.indices.get(&#39;*&#39;)) and \
            (&#39;blacklist&#39; not in es.indices.get(&#39;*&#39;)):
        es.index(index=&#39;not_vetted&#39;, id=1, body={})
        es.index(index=&#39;benign_vet&#39;, id=1, body={})
        es.index(index=&#39;honeypot&#39;, id=1, body={})
        es.index(index=&#39;blacklist&#39;, id=1, body={})</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="middleware.list_updation" href="#middleware.list_updation">list_updation</a></code></li>
<li><code><a title="middleware.mal_and_benign_list_creation" href="#middleware.mal_and_benign_list_creation">mal_and_benign_list_creation</a></code></li>
<li><code><a title="middleware.server" href="#middleware.server">server</a></code></li>
<li><code><a title="middleware.string_to_ascii" href="#middleware.string_to_ascii">string_to_ascii</a></code></li>
<li><code><a title="middleware.update_historical_analysis" href="#middleware.update_historical_analysis">update_historical_analysis</a></code></li>
<li><code><a title="middleware.vetted_list_creation" href="#middleware.vetted_list_creation">vetted_list_creation</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>